

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Day 2 Cluster Operation &mdash; Faros 0.5 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://faros.devoperate.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Verified Implimentation" href="example.html" />
    <link rel="prev" title="Cluster Deployment" href="deploy.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #19647E" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo_name_white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Cluster Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Faros Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Cluster Deployment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Day 2 Cluster Operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#start-up-and-shutdown-procedures">Start up and shutdown procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-the-cluster">Updating the cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#patch-the-cluster">Patch the cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#patch-the-bastion-node">Patch the bastion node</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deploying-container-storage">Deploying container storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enable-cluster-registry">Enable cluster registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enable-registry-pruning">Enable registry pruning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-user-accounts">Configure user accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploying-open-data-hub-demo">Deploying Open Data Hub demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-cluster-https-certs">Configure cluster HTTPS certs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-nodes-to-the-cluster">Add nodes to the cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Verified Implimentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">repos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">devenv</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">ansiblefacts</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">deploys</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">docs</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/projects/1">Roadmap</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/issues">Bug Report</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros">GitHub</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Faros</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Day 2 Cluster Operation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- User defined GitHub URL -->
              <a href="https://github.com/project-faros/faros.dev/blob/master/source/operate.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="day-2-cluster-operation">
<h1>Day 2 Cluster Operation<a class="headerlink" href="#day-2-cluster-operation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="start-up-and-shutdown-procedures">
<h2>Start up and shutdown procedures<a class="headerlink" href="#start-up-and-shutdown-procedures" title="Permalink to this headline">¶</a></h2>
<p>The Faros tooling includes scripts for automated cluster shutdown and startup:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Safely stop and bring down the cluster</span>
farosctl shutdown
<span class="c1"># Shutdown the bastion node</span>
poweroff

<span class="c1"># Bring the cluster up and wait for it to be healthy</span>
farosctl startup
</pre></div>
</div>
</div>
<div class="section" id="updating-the-cluster">
<h2>Updating the cluster<a class="headerlink" href="#updating-the-cluster" title="Permalink to this headline">¶</a></h2>
<div class="section" id="patch-the-cluster">
<h3>Patch the cluster<a class="headerlink" href="#patch-the-cluster" title="Permalink to this headline">¶</a></h3>
<p>The OpenShift cluster may be patched by following the standard procedures. It
is recomened to use the GUI for patching. The official Red Hat documentation
containers detailed <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/updating/updating-cluster.html">OpenShift updating instructions</a>.</p>
</div>
<div class="section" id="patch-the-bastion-node">
<h3>Patch the bastion node<a class="headerlink" href="#patch-the-bastion-node" title="Permalink to this headline">¶</a></h3>
<p>To patch the bastion node, simply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dnf -y update
reboot
</pre></div>
</div>
<p>Please note, there will be a cluster disruption while the bastion node is
patched. Cluster services will continue to run, but they will be unavailable.</p>
</div>
</div>
<div class="section" id="deploying-container-storage">
<h2>Deploying container storage<a class="headerlink" href="#deploying-container-storage" title="Permalink to this headline">¶</a></h2>
<p>There are many options for persistent cluster storage, but OpenShift Container
Storage (OCS) is preferred for a few reasons:</p>
<blockquote>
<div><ul class="simple">
<li><p>OCS is gauranteed to work with OpenShift</p></li>
<li><p>OCS provides file, block, and object storage support RWX</p></li>
<li><p>OCS runs on the cluster nodes and does not require additional hardware</p></li>
</ul>
</div></blockquote>
<p>To run through an automated storage deployment, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>farosctl deploy container-storage
</pre></div>
</div>
<p>This will launch an interactive menu to choose which nodes should be used for
storage and then which drives on those nodes should be dedicated to storage.
OCS requires full block devices on the nodes and cannot simply use part of a
partitioned drive. The drive must be wipped prior to building the storage
cluster.</p>
<p>Once storage is available to the cluster, it is a good practice to set the
default StorageClass. Official documentation is here for <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/storage/dynamic-provisioning.html#change-default-storage-class_dynamic-provisioning">changing the default
StorageClass</a>.
To set the CephFS storage class to be the default, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>oc patch storageclass ocs-storagecluster-cephfs -p <span class="s1">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;: {&quot;storageclass.kubernetes.io/is-default-class&quot;: &quot;true&quot;}}}&#39;</span>
</pre></div>
</div>
<p>There is currently a known issue with storage that causes some nuisance
warnings to be thrown. If the <em>lib-bucket-provisioner</em> operator is flapping on
your cluster after a storage install, the instructions to fix this can be found
<cite>here &lt;https://access.redhat.com/solutions/5221881&gt;</cite>.</p>
</div>
<div class="section" id="enable-cluster-registry">
<h2>Enable cluster registry<a class="headerlink" href="#enable-cluster-registry" title="Permalink to this headline">¶</a></h2>
<p>Because storage is not originally available in a bare metal deployment, the
cluster image registry cannot be created until after storage is made available.
Now the storage is available, it is time to <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/registry/configuring-registry-operator.html#registry-removed_configuring-registry-operator">enable the cluster registry</a>.</p>
<p>Here is an example <em>config.imageregistry.operator.openshift.io/default</em> resource.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apiVersion: imageregistry.operator.openshift.io/v1
kind: Config
metadata:
finalizers:
- imageregistry.operator.openshift.io/finalizer
name: cluster
spec:
logging: <span class="m">2</span>
managementState: Managed
proxy: <span class="o">{}</span>
replicas: <span class="m">1</span>
requests:
    read:
    maxWaitInQueue: 0s
    write:
    maxWaitInQueue: 0s
rolloutStrategy: RollingUpdate
storage:
    pvc:
    claim:
</pre></div>
</div>
</div>
<div class="section" id="enable-registry-pruning">
<h2>Enable registry pruning<a class="headerlink" href="#enable-registry-pruning" title="Permalink to this headline">¶</a></h2>
<p>Once the registry is enabled, image pruning should also be enabled to reduce
clutter.</p>
<p>The <em>config.imagepruner.imageregistry.operator.openshift.io/cluster</em> resource
definition should look like the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apiVersion: imageregistry.operator.openshift.io/v1
kind: ImagePruner
metadata:
  name: cluster
spec:
  failedJobsHistoryLimit: <span class="m">3</span>
  keepTagRevisions: <span class="m">3</span>
  schedule: <span class="s2">&quot;&quot;</span>
  successfulJobsHistoryLimit: <span class="m">3</span>
  suspend: <span class="nb">false</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-user-accounts">
<h2>Configure user accounts<a class="headerlink" href="#configure-user-accounts" title="Permalink to this headline">¶</a></h2>
<p>There are many options for configuring user accounts in OpenShift. Two common
methods are <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/identity_providers/configuring-ldap-identity-provider.html">using LDAP authentication</a>
or <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/identity_providers/configuring-htpasswd-identity-provider.html">using an HTPasswd file</a>.</p>
</div>
<div class="section" id="deploying-open-data-hub-demo">
<h2>Deploying Open Data Hub demo<a class="headerlink" href="#deploying-open-data-hub-demo" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate the capabilities of OpenShift for data scientists, a demo Open
Data Hub environment can be quickly deployed using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>farosctl deploy odh-demo
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open Data Hub is a community supported project and not a Red Hat product.
Deployment of this demo requires that storge and the cluster registry have
both been configured.</p>
</div>
</div>
<div class="section" id="configure-cluster-https-certs">
<h2>Configure cluster HTTPS certs<a class="headerlink" href="#configure-cluster-https-certs" title="Permalink to this headline">¶</a></h2>
<p>Not strictly necessary, but often desireable, official documentation is
available on how to <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/certificates/replacing-default-ingress-certificate.html">update the application HTTPS certificate</a>
and on how to <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/certificates/api-server.html">update the API HTTPS certificate</a>.</p>
</div>
<div class="section" id="add-nodes-to-the-cluster">
<h2>Add nodes to the cluster<a class="headerlink" href="#add-nodes-to-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>To add additional application nodes to the cluster, the DHCP and DNS zones on
the bastion must be manually updated to add records for that host and configure
them to PXE boot to the CoreOS installer with the worker ignition file.
Detailed instructions are available for <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/installing/installing_bare_metal/installing-bare-metal.html#installation-user-infra-machines-pxe_installing-bare-metal">creating RHCOS machines with PXE
booting</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example.html" class="btn btn-neutral float-right" title="Verified Implimentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="deploy.html" class="btn btn-neutral float-left" title="Cluster Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Project Faros Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>